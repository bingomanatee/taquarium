<!DOCTYPE html>
<!-- saved from url=(0078)http://alteredqualia.com/three/examples/webgl_deferred_arealights_texture.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>three.js webgl - deferred area lights [video texture]</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				background-color: #000;
				margin: 0px;
				overflow: hidden;
			}

			#info {
				position: absolute;
				top: 20px; width: 100%;
				color: #ffffff;
				padding: 5px;
				font-family: Monospace;
				font-size: 13px;
				text-align: center;
			}

			a {
				color: #ff0080;
				text-decoration: none;
			}

			a:hover {
				color: #0080ff;
			}

			#stats { position: absolute; top:10px; left: 5px }
			#stats #fps { background: transparent !important }
			#stats #fps #fpsText { color: #aaa !important }
			#stats #fps #fpsGraph { display: none }
		</style>
	</head>

	<body>
		<div id="info">
			<a href="http://threejs.org/" target="_blank">three.js</a> - textured area lights -
			based on <a href="http://www.gamedev.net/topic/552315-glsl-area-light-implementation/" target="_blank">ArKano22</a> and
			<a href="http://devlog-martinsh.blogspot.sk/2012/11/bge-candy-area-lights.html">martinsh</a> glsl implementation -
			<a href="http://www.nasa.gov/multimedia/videogallery/index.html?media_id=141042671" target="_blank">Walking on Air</a> video
			by <a href="http://www.nasa.gov/" target="_blank">NASA</a>
		</div>
		<div id="container"><canvas width="1425" height="535" style="width: 1425px; height: 535px; position: absolute; top: 100px; left: 0px;"></canvas><div id="stats" style="width: 80px; opacity: 0.9; cursor: pointer; position: absolute; top: 8px; z-index: 100;"><div id="fps" style="padding: 0px 0px 3px 3px; text-align: left; background-color: rgb(0, 0, 34);"><div id="fpsText" style="color: rgb(0, 255, 255); font-family: Helvetica, Arial, sans-serif; font-size: 9px; font-weight: bold; line-height: 15px;">19 FPS (8-30)</div><div id="fpsGraph" style="position: relative; width: 74px; height: 30px; background-color: rgb(0, 255, 255);"><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 30px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 27.6px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 26.1px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 23.7px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 21px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 22.5px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 21.6px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 21px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 23.1px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 26.7px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 22.2px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 21.3px; float: left; background-color: rgb(17, 17, 51);"></span><span style="width: 1px; height: 24.3px; float: left; background-color: rgb(17, 17, 51);"></span></div></div><div id="ms" style="padding: 0px 0px 3px 3px; text-align: left; background-color: rgb(0, 34, 0); display: none;"><div id="msText" style="color: rgb(0, 255, 0); font-family: Helvetica, Arial, sans-serif; font-size: 9px; font-weight: bold; line-height: 15px;">67 MS (12-685)</div><div id="msGraph" style="position: relative; width: 74px; height: 30px; background-color: rgb(0, 255, 0);"><span style="width: 1px; height: 22.5px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 19.95px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 27.45px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.2px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 15px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 27.45px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.75px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.2px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.2px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.75px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.75px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.2px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.75px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.2px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.75px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 22.35px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.2px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 22.5px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.05px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 22.5px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.75px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 25.2px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 19.95px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 27.3px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 17.25px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 27.6px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 27.75px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 24.9px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 17.4px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 22.8px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 27.3px; float: left; background-color: rgb(17, 51, 17);"></span><span style="width: 1px; height: 19.95px; float: left; background-color: rgb(17, 51, 17);"></span></div></div></div></div>

            <script src="deferred_files/three.max.deferredareatexture.js"></script>

        <script src="/js/libs/three/loaders/LoadingManager.js"></script>
        <script src="/js/libs/three/loaders/XHRLoader.js"></script>
        <script src="/js/libs/three/loaders/OBJLoader2.js"></script>
            <!--
           <script src="/js/libs/three/Detector.js"></script>   <!--
               <script src="/js/libs/three.min.js"></script>

               <script src="/js/libs/three/Detector.js"></script>

               <script src="/js/libs/three/renderers/WebGLDeferredRenderer2.js"></script>
               <script src="/js/libs/three/ShaderDeferred.js"></script>

               <script src="/js/libs/three/shaders/CopyShader.js"></script>
               <script src="/js/libs/three/shaders/FXAAShader.js"></script>
               <script src="/js/libs/three/shaders/ConvolutionShader.js"></script>

               <script src="/js/libs/three/postprocessing/EffectComposer.js"></script>
               <script src="/js/libs/three/postprocessing/RenderPass.js"></script>
               <script src="/js/libs/three/postprocessing/ShaderPass.js"></script>
               <script src="/js/libs/three/postprocessing/MaskPass.js"></script>
               <script src="/js/libs/three/postprocessing/BloomPass.js"></script> -->
            

		<script src="deferred_files/stats.min.js"></script>

		<video id="video" autoplay="" loop="" style="display:none">
			<source src="/textures/video.mp4">
		</video>

		<script>

			if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

			var SCALE = 1;
			var MARGIN = 100;

			var WIDTH = window.innerWidth;
			var HEIGHT = window.innerHeight - 2 * MARGIN;

			var NEAR = 1.0, FAR = 350.0;
			var VIEW_ANGLE = 30;

			// controls

			var mouseX = 0;
			var mouseY = 0;

			var targetX = 0, targetY = 0;
			var angle = 0;
			var target = new THREE.Vector3( 0, 0, 0 );

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;

			// core

			var renderer, camera, scene, stats, clock;

			// lights

			var areaLight1, areaLight2, areaLight3;

			//

			var video;
			var morph;

			//

			init();
			animate();

			// -----------------------------

			function init() {

				// camera

				camera = new THREE.PerspectiveCamera( VIEW_ANGLE, WIDTH / HEIGHT, NEAR, FAR );
				camera.position.y = 10;

				// scene

				scene = new THREE.Scene();
				scene.add( camera );

				// video

				video = document.getElementById( 'video' );
				//video.volume = 0;

				texture = new THREE.Texture( video );
				texture.format = THREE.RGBFormat;

				// renderer

				renderer = new THREE.WebGLDeferredRenderer( { width: WIDTH, height: HEIGHT, scale: SCALE, antialias: true, tonemapping: THREE.UnchartedOperator, brightness: 4 } );

				renderer.domElement.style.position = "absolute";
				renderer.domElement.style.top = MARGIN + "px";
				renderer.domElement.style.left = "0px";

				var container = document.getElementById( 'container' );
				container.appendChild( renderer.domElement );

				// effects

				//var bloomEffect = new THREE.BloomPass( 0.65 );
				//renderer.addEffect( bloomEffect );

				// stats

				stats = new Stats();
				stats.domElement.style.position = 'absolute';
				stats.domElement.style.top = '8px';
				stats.domElement.style.zIndex = 100;
				container.appendChild( stats.domElement );

				// clock

				clock = new THREE.Clock();

				// add lights

				initLights();

				// add objects

				initObjects();

				// events

				document.addEventListener( 'mousemove', onDocumentMouseMove, false );
				window.addEventListener( 'resize', onWindowResize, false );

			}

			// -----------------------------

			function createAreaEmitter( light ) {

				var geometry = new THREE.PlaneGeometry( light.width * 2, light.height * 2 );

				var m = new THREE.Matrix4();
				m.makeRotationX( Math.PI/2 );
				geometry.applyMatrix( m );

				var material = new THREE.MeshBasicMaterial( { color: light.color.getHex(), vertexColors: THREE.FaceColors } );
				material.map = light.texture;
				//material.alphaTest = 0.5;

				var emitter = new THREE.Mesh( geometry, material );

				emitter.position = light.position;
				emitter.rotation = light.rotation;

				return emitter;

			}

			function setupAreaLight( light ) {

				var matrix = light.matrixWorld;

				light.right.set( 1, 0, 0 );
				light.normal.set( 0, -1, 0 );
				light.right = matrix.multiplyVector3( light.right );
				light.normal = matrix.multiplyVector3( light.normal );

			}

			function initLights() {

				var intensity = 4;

				areaLight1 = new THREE.AreaLight( 0xffffff, intensity );
				areaLight1.position.set( 0.0001, 7, -15.5001 );
				areaLight1.rotation.set( -1.474719, 0, 0 );
				areaLight1.width = 12;
				areaLight1.height = 6;

				//var texture = THREE.ImageUtils.loadTexture( "textures/hello.png" );
				//var texture = THREE.ImageUtils.loadTexture( "textures/disturb-normal.png" );
				//var texture = THREE.ImageUtils.loadTexture( "textures/ash_uvgrid01.jpg" );
				texture.wrapS = texture.wrapT = THREE.MirroredRepeatWrapping;
				texture.anisotropy = 4;
				areaLight1.texture = texture;

				scene.add( areaLight1 );

				var meshEmitter = createAreaEmitter( areaLight1 );
				scene.add( meshEmitter );

				//

				areaLight2 = new THREE.AreaLight( 0xffffff, intensity );
				areaLight2.position.set( -19.0001, 7, 0.0001 );
				areaLight2.rotation.set( -1.5707, 0.1, 1.5707 );
				areaLight2.width = 12;
				areaLight2.height = 6;
				areaLight2.texture = texture;

				scene.add( areaLight2 );

				var meshEmitter = createAreaEmitter( areaLight2 );
				scene.add( meshEmitter );

				//

				areaLight3 = new THREE.AreaLight( 0xffffff, intensity );
				areaLight3.position.set( 19.0001, 7, 0.0001 );
				areaLight3.rotation.set( -1.5707, -0.1, -1.5707 );
				areaLight3.width = 12;
				areaLight3.height = 6;
				areaLight3.texture = texture;

				scene.add( areaLight3 );

				var meshEmitter = createAreaEmitter( areaLight3 );
				scene.add( meshEmitter );

			}

			// -----------------------------

			function initObjects() {

				// floor

				var floorMap = THREE.ImageUtils.loadTexture( "obj/lightmap/stone.jpg" );
				floorMap.wrapS = floorMap.wrapT = THREE.RepeatWrapping;
				floorMap.repeat.set( 8, 8 );
				floorMap.anisotropy = 4;

				var object = new THREE.Mesh( new THREE.PlaneGeometry( 50, 50 ), new THREE.MeshPhongMaterial( { color: 0x222222, specular: 0xffffff, bumpMap: floorMap, bumpScale: 0.05 } ) );
				object.rotation.x = -Math.PI/2;
				scene.add( object );
/*
				// morph

				var loader = new THREE.JSONLoader();
				loader.load( "models/animated/sittingBox2.js", function( geometry ) {

					var morphMaterial = new THREE.MeshPhongMaterial( { color: 0xdddddd, specular: 0xffffff, shininess: 50, morphTargets: true, morphNormals: true, side: THREE.DoubleSide } );
					morphMaterial.shading = THREE.FlatShading;

					geometry.computeMorphNormals();
					morph = new THREE.MorphAnimMesh( geometry, morphMaterial );

					var s = 10;
					morph.scale.set( s, s, s );
					morph.rotation.y = Math.PI;

					morph.duration = 8000;
					morph.mirroredLoop = true;

					morph.castShadow = true;
					morph.receiveShadow = true;

					scene.add( morph );

				} ); */

                // texture

                var manager = new THREE.LoadingManager();
                manager.onProgress = function (item, loaded, total) {

                    console.log(item, loaded, total);

                };

                var texture = new THREE.Texture();

                function onLoad(event) {
// do something
                    texture.image = event.image;
                    texture.needsUpdate = true;
                }

                function onError(event) {
// do something
                }

                texture = THREE.ImageUtils.loadTexture('/Taco/obj/taco_texture.jpg',{},onLoad,onError)

                var loader = new THREE.ImageLoader(manager);
          /*      loader.load('/Taco/obj/taco_texture.jpg', function (image) {


                });*/


                // model

                var loader2 = new THREE.OBJLoader(manager);
                loader2.load('/Taco/obj/taco.obj', function (object) {
                    console.log('taco loaded');

                    object.traverse(function (child) {

                        if (child instanceof THREE.Mesh) {

                            child.material.map = texture;

                        }

                    });

                    object.position.y = 0;
                    object.position.z = 10;
                    object.rotation.y = Math.PI / 8;
                    object.scale.set(10, 10, 10);
                    scene.add(object);

                });

			}


			// -----------------------------

			function onWindowResize( event ) {

				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;

				WIDTH = window.innerWidth;
				HEIGHT = window.innerHeight - 2 * MARGIN;

				renderer.setSize( WIDTH, HEIGHT );

				camera.aspect = WIDTH / HEIGHT;
				camera.updateProjectionMatrix();

			}

			function onDocumentMouseMove( event ) {

				mouseX = ( event.clientX - windowHalfX ) * 1;
				mouseY = ( event.clientY - windowHalfY ) * 1;

			}

			// -----------------------------

			function animate() {

				requestAnimationFrame( animate );

				render();
				stats.update();

			}

			function render() {

				// update video texture

				if ( video.readyState === video.HAVE_ENOUGH_DATA && texture ) texture.needsUpdate = true;

				// update camera

				var delta = clock.getDelta();

				targetX = mouseX * .002;
				targetY = mouseY * .001;

				angle += 0.05 * ( targetX - angle );

				camera.position.x = -Math.sin( angle ) * 40;
				camera.position.z =  Math.cos( angle ) * 40;

				camera.lookAt( target );

				// update morph

				if ( morph ) morph.updateAnimation( delta * 1000 );

				// render

				renderer.render( scene, camera );

			}

		</script>
	


</body></html>